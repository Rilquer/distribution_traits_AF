a <- spp_mat %>% rowwise() %>% mutate(richness = sum(select(!all_of(c('x','y')))))
a <- spp_mat %>% rowwise() %>% mutate(richness = sum(c_across(3:ncol(spp_mat))))
glimpse(a)
spp_mat <- a
glimpse(spp_mat)
library(tidyverse)
library(taxize)
library(raster)
library(sf)
library(rgdal)
prioritize(dplyr)
?prioritize
library(needs)
library(tidyverse)
library(taxize)
library(raster)
library(sf)
library(rgdal)
library(needs)
prioritize(dplyr)
richness <- rasterFromXYZ(spp_mat %>% select(x,y,richness))
plot(richness)
ggplot()+
geom_tile(data = spp_mat, aes(x=x,y=y,fill=richness))+
scale_fill_gradient2(low = '#2b83ba', mid = '#fffebd', high = '#d7191c',
midpoint = max(spp_mat$richness)/2)
ggplot()+
geom_raster(data = spp_mat, aes(x=x,y=y,fill=richness))+
#scale_fill_gradient2(low = '#2b83ba', mid = '#fffebd', high = '#d7191c',
#                     midpoint = max(spp_mat$richness)/2)
scale_fill_gradient(low = '#2b83ba', mid = '#fffebd', high = '#d7191c',
midpoint = max(spp_mat$richness)/2)
ggplot()+
geom_raster(data = spp_mat, aes(x=x,y=y,fill=richness))+
#scale_fill_gradient2(low = '#2b83ba', mid = '#fffebd', high = '#d7191c',
#                     midpoint = max(spp_mat$richness)/2)
scale_fill_gradient2(low = '#2b83ba', mid = '#fffebd', high = '#d7191c',
midpoint = max(spp_mat$richness)/2)
ggplot()+
geom_tile(data = spp_mat, aes(x=x,y=y,fill=richness))+
#scale_fill_gradient2(low = '#2b83ba', mid = '#fffebd', high = '#d7191c',
#                     midpoint = max(spp_mat$richness)/2)
scale_fill_gradient2(low = '#2b83ba', mid = '#fffebd', high = '#d7191c',
midpoint = max(spp_mat$richness)/2)+
coord_sf(xlim = c(ext[1],ext[2]), ylim = c(ext[3],ext[4]),
expand = FALSE)
ggplot()+
geom_tile(data = spp_mat, aes(x=x,y=y,fill=richness))+
#scale_fill_gradient2(low = '#2b83ba', mid = '#fffebd', high = '#d7191c',
#                     midpoint = max(spp_mat$richness)/2)
scale_fill_gradient(low = '#2b83ba', high = '#d7191c')+
coord_sf(xlim = c(ext[1],ext[2]), ylim = c(ext[3],ext[4]),
expand = FALSE)
ggplot()+
geom_tile(data = spp_mat, aes(x=x,y=y,fill=richness))+
#scale_fill_gradient2(low = '#2b83ba', mid = '#fffebd', high = '#d7191c',
#                     midpoint = max(spp_mat$richness)/2)
#scale_fill_gradient(low = '#2b83ba', high = '#d7191c')+
scale_fill_gradient2(low = '#253494', mid = '#41b6c4', high = '#ffffcc',
midpoint = max(spp_mat$richness)/2)+
coord_sf(xlim = c(ext[1],ext[2]), ylim = c(ext[3],ext[4]),
expand = FALSE)
ggplot()+
geom_tile(data = spp_mat, aes(x=x,y=y,fill=richness))+
#scale_fill_gradient2(low = '#2b83ba', mid = '#fffebd', high = '#d7191c',
#                     midpoint = max(spp_mat$richness)/2)
#scale_fill_gradient(low = '#2b83ba', high = '#d7191c')+
scale_fill_gradient2(low = '#253494', mid = '#41b6c4', high = '#f03b20',
midpoint = max(spp_mat$richness)/2)+
coord_sf(xlim = c(ext[1],ext[2]), ylim = c(ext[3],ext[4]),
expand = FALSE)
ggplot()+
geom_tile(data = spp_mat, aes(x=x,y=y,fill=richness))+
#scale_fill_gradient2(low = '#2b83ba', mid = '#fffebd', high = '#d7191c',
#                     midpoint = max(spp_mat$richness)/2)
#scale_fill_gradient(low = '#2b83ba', high = '#d7191c')+
scale_fill_gradient2(low = '#253494', mid = '#41b6c4', high = '#f03b20',
midpoint = max(spp_mat$richness)/2)+
coord_sf(xlim = c(ext[1],ext[2]), ylim = c(ext[3],ext[4]),
expand = FALSE)
ggplot()+
geom_tile(data = spp_mat, aes(x=x,y=y,fill=richness))+
scale_fill_viridis_b()+
#scale_fill_gradient2(low = '#2b83ba', mid = '#fffebd', high = '#d7191c',
#                     midpoint = max(spp_mat$richness)/2)
#scale_fill_gradient(low = '#2b83ba', high = '#d7191c')+
#scale_fill_gradient2(low = '#253494', mid = '#41b6c4', high = '#f03b20',
#                     midpoint = max(spp_mat$richness)/2)+
coord_sf(xlim = c(ext[1],ext[2]), ylim = c(ext[3],ext[4]),
expand = FALSE)
ggplot()+
geom_tile(data = spp_mat, aes(x=x,y=y,fill=richness))+
scale_fill_viridis_d()+
#scale_fill_gradient2(low = '#2b83ba', mid = '#fffebd', high = '#d7191c',
#                     midpoint = max(spp_mat$richness)/2)
#scale_fill_gradient(low = '#2b83ba', high = '#d7191c')+
#scale_fill_gradient2(low = '#253494', mid = '#41b6c4', high = '#f03b20',
#                     midpoint = max(spp_mat$richness)/2)+
coord_sf(xlim = c(ext[1],ext[2]), ylim = c(ext[3],ext[4]),
expand = FALSE)
sort(unique(spp_mat$richness)
)
glimpse(spp_mat)
ggplot()+
geom_tile(data = spp_mat, aes(x=x,y=y,fill=richness))+
scale_fill_viridis()+
#scale_fill_gradient2(low = '#2b83ba', mid = '#fffebd', high = '#d7191c',
#                     midpoint = max(spp_mat$richness)/2)
#scale_fill_gradient(low = '#2b83ba', high = '#d7191c')+
#scale_fill_gradient2(low = '#253494', mid = '#41b6c4', high = '#f03b20',
#                     midpoint = max(spp_mat$richness)/2)+
coord_sf(xlim = c(ext[1],ext[2]), ylim = c(ext[3],ext[4]),
expand = FALSE)
library(viridis)
ggplot()+
geom_tile(data = spp_mat, aes(x=x,y=y,fill=richness))+
scale_fill_viridis()+
#scale_fill_gradient2(low = '#2b83ba', mid = '#fffebd', high = '#d7191c',
#                     midpoint = max(spp_mat$richness)/2)
#scale_fill_gradient(low = '#2b83ba', high = '#d7191c')+
#scale_fill_gradient2(low = '#253494', mid = '#41b6c4', high = '#f03b20',
#                     midpoint = max(spp_mat$richness)/2)+
coord_sf(xlim = c(ext[1],ext[2]), ylim = c(ext[3],ext[4]),
expand = FALSE)
library(ggsci)
install.packages('ggsci')
library(ggsci)
ggplot()+
geom_tile(data = spp_mat, aes(x=x,y=y,fill=richness))+
scale_fill_npg()+
#scale_fill_gradient2(low = '#2b83ba', mid = '#fffebd', high = '#d7191c',
#                     midpoint = max(spp_mat$richness)/2)
#scale_fill_gradient(low = '#2b83ba', high = '#d7191c')+
#scale_fill_gradient2(low = '#253494', mid = '#41b6c4', high = '#f03b20',
#                     midpoint = max(spp_mat$richness)/2)+
coord_sf(xlim = c(ext[1],ext[2]), ylim = c(ext[3],ext[4]),
expand = FALSE)
ggplot()+
geom_tile(data = spp_mat, aes(x=x,y=y,fill=richness))+
scale_fill_aaas()+
#scale_fill_gradient2(low = '#2b83ba', mid = '#fffebd', high = '#d7191c',
#                     midpoint = max(spp_mat$richness)/2)
#scale_fill_gradient(low = '#2b83ba', high = '#d7191c')+
#scale_fill_gradient2(low = '#253494', mid = '#41b6c4', high = '#f03b20',
#                     midpoint = max(spp_mat$richness)/2)+
coord_sf(xlim = c(ext[1],ext[2]), ylim = c(ext[3],ext[4]),
expand = FALSE)
ggplot()+
geom_tile(data = spp_mat, aes(x=x,y=y,fill=richness))+
#scale_fill_viridis()+
scale_fill_gradient2(low = '#2b83ba', mid = '#fffebd', high = '#d7191c',
midpoint = max(spp_mat$richness)/2)
ggplot()+
geom_tile(data = spp_mat, aes(x=x,y=y,fill=richness))+
#scale_fill_viridis()+
scale_fill_gradient2(low = '#2b83ba', mid = '#fffebd', high = '#d7191c')+
#scale_fill_gradient(low = '#2b83ba', high = '#d7191c')+
#scale_fill_gradient2(low = '#253494', mid = '#41b6c4', high = '#f03b20',
#                     midpoint = max(spp_mat$richness)/2)+
coord_sf(xlim = c(ext[1],ext[2]), ylim = c(ext[3],ext[4]),
expand = FALSE)
hist(spp_mat$richness)
length(which(spp_mat$richness==0))
nrow(spp_mat)
ggplot()+
geom_tile(data = spp_mat, aes(x=x,y=y,fill=richness))+
#scale_fill_viridis()+
scale_fill_gradient2(low = '#2b83ba', mid = '#fffebd', high = '#d7191c',
midpoint = 175)+
#scale_fill_gradient(low = '#2b83ba', high = '#d7191c')+
#scale_fill_gradient2(low = '#253494', mid = '#41b6c4', high = '#f03b20',
#                     midpoint = max(spp_mat$richness)/2)+
coord_sf(xlim = c(ext[1],ext[2]), ylim = c(ext[3],ext[4]),
expand = FALSE)
ggplot()+
geom_tile(data = spp_mat, aes(x=x,y=y,fill=richness))+
#scale_fill_viridis()+
scale_fill_gradient2(low = '#2b83ba', mid = '#fffebd', high = '#d7191c',
midpoint = 175)+
#scale_fill_gradient(low = '#2b83ba', high = '#d7191c')+
#scale_fill_gradient2(low = '#253494', mid = '#41b6c4', high = '#f03b20',
#                     midpoint = max(spp_mat$richness)/2)+
coord_sf(xlim = c(ext[1],ext[2]), ylim = c(ext[3],ext[4]),
expand = FALSE)
plot(richness)
hist(spp_mat$richness)
b=hist(spp_mat$richness)
b
low_values <- spp_mat %>% filter(richness < 80)
plot(richness)
points(low_values[,1:2])
spp_mat <- spp_mat %>% rowwise() %>% mutate(richness = sum(c_across(3:ncol(spp_mat)))) %>%
ungroup() %>% filter(richness > 80)
spp_mat <- rasterToPoints(spp_stack) %>% as_tibble()
spp_mat <- spp_mat %>% rowwise() %>% mutate(richness = sum(c_across(3:ncol(spp_mat)))) %>%
ungroup() %>% filter(richness > 80)
ggplot()+
geom_tile(data = spp_mat, aes(x=x,y=y,fill=richness))+
scale_fill_gradient2(low = '#2b83ba', mid = '#fffebd', high = '#d7191c',
midpoint = 175)+
coord_sf(xlim = c(ext[1],ext[2]), ylim = c(ext[3],ext[4]),
expand = FALSE)
View(spp_mat)
library(hillR)
?hill_func
?hill_taxa_parti
?hill_func
af_data
glimpse(af_data)
traits <- af_data %>% select(-c(Binomial,polygon))
glimpse(traits)
rownames(traits) <- paste0('r',seq(1:nrow(traits)))
traits <- af_data %>% select(-c(Binomial,polygon)) %>% as_data_frame()
traits <- af_data %>% select(-c(Binomial,polygon)) %>% as.data.frame()
af_data$Binomial
gsub(' ','.',af_data$Binomial)
colnames(spp_mat)
colnames(spp_mat) <- gsub('.',' ',colnames(spp_mat))
colnames(spp_mat)
spp_mat <- rasterToPoints(spp_stack) %>% as_tibble()
teste <- c('a','b.','c')
teste
gsub('//.',' ',teste)
gsub('\\.',' ',teste)
gsub('.',' ',teste)
spp_mat <- rasterToPoints(spp_stack) %>% as_tibble()
spp_mat
colnames(spp_mat) <- gsub('\\.',' ',colnames(spp_mat))
spp_mat
spp_mat <- spp_mat %>% rowwise() %>% mutate(richness = sum(c_across(3:ncol(spp_mat)))) %>%
ungroup() %>% filter(richness > 80)
colnames(spp_mat)
richness <- rasterFromXYZ(spp_mat %>% select(x,y,richness))
plot(richness)
glimpse(af_data)
traits <- af_data %>% select(-c(Binomial,polygon)) %>% as.data.frame()
traits
glimpse(traits)
rownames(traits) <- af_data$Binomial
?hill_func
glimpse(spp_mat)
comm <- spp_mat %>% select(-c(x,y,richness))
glimpse(comm)
comm
a <- hill_func(comm,traits)
for (i in 3:(ncol(spp_mat)-1)) {
uni <- unique(spp_mat[,i])
if (length(uni)<2) {
print(colnames(spp_mat)[i])
print(uni)
}
}
uni
unique(spp_mat[,i])
spp_mat[,i]
as.vector(spp_mat[,i])
uni <- unique(as.vector(spp_mat[,i]))
uni
uni <- unique(as.vector(spp_mat[,i]))
uni
as.vector(spp_mat[,i])
unique(as.vector(spp_mat[,i]))
as.array(spp_mat[,i])
as.numeric(spp_mat[,i])
vec <- as.vector(spp_mat[,i])[[1]]
vec
unique(vec)
uni <- unique(vec)
length(uni)
for (i in 3:(ncol(spp_mat)-1)) {
vec <- as.vector(spp_mat[,i])[[1]]
uni <- unique(vec)
if (length(uni)<2) {
print(colnames(spp_mat)[i])
print(uni)
}
}
for (i in 3:(ncol(spp_mat)-1)) {
vec <- as.vector(spp_mat[,i])[[1]]
uni <- unique(vec)
if (length(uni)<2) {
if (uni[1]==0) {
print(colnames(spp_mat)[i])
print(uni)
}
}
}
spp_stack
spp_stack[['Basileuterus.culicivorus']]
plot(spp_stack[['Basileuterus.culicivorus']])
absent_spp <- c()
for (i in 3:(ncol(spp_mat)-1)) {
vec <- as.vector(spp_mat[,i])[[1]]
uni <- unique(vec)
if (length(uni)<2) {
if (uni[1]==0) {
absent_spp <- c(absent_spp,colnames(spp_mat)[i])
}
}
}
absent_spp
absent_spp <- c()
for (i in 3:(ncol(spp_mat)-1)) {
vec <- as.vector(spp_mat[,i])[[1]]
uni <- unique(vec)
if (length(uni)<2) {
if (uni[1]==0) {
absent_spp <- c(absent_spp,colnames(spp_mat)[i])
}
}
}
absent_spp
absent <- af_data %>% filter(Binomial %in% absent_spp)
absent
absent$polygon[1]
shape <- read_sf(paste0('data/spatial/vector/birdlife_polygons/',absent$polygon[1],'.shp'))
ggplot()+geom_sf(data=shape)
spp_r <- mask(r,as_Spatial(shape)) # Masking out where the species is absent
plot(spp_r)
r
plot(r)
plot(spp_r)
spp_r[is.na(spp_r)] <- 0 # Changing absence to 0
plot(spp_r)
shape <- read_sf(paste0('data/spatial/vector/birdlife_polygons/',absent$polygon[2],'.shp'))
ggplot()+geom_sf(data=shape)
shape <- read_sf(paste0('data/spatial/vector/birdlife_polygons/',absent$polygon[2],'.shp'))
ggplot()+geom_sf(data=shape)+geom_sf(data=af_shapefile)
absent_spp[2]
# Checking species absent in all and dropping them
absent_spp <- c()
for (i in 3:(ncol(spp_mat)-1)) {
vec <- as.vector(spp_mat[,i])[[1]]
uni <- unique(vec)
if (length(uni)<2) {
if (uni[1]==0) {
absent_spp <- c(absent_spp,colnames(spp_mat)[i])
}
}
}
absent_spp
b <- spp_mat %>% select(-c(absent_spp))
n
b
ncol(b)
ncol(spp_mat)
length(absent_spp)
407-398
b <- spp_mat %>% select(!all_of(absent_spp))
ncol(b)
grep('Basileuterus culicivorus',colnames(b))
spp_mat <- spp_mat %>% select(!all_of(absent_spp))
ncol(spp_mat)
comm <- spp_mat %>% select(-c(x,y,richness))
a <- hill_func(comm,traits)
traits <- af_data %>% filter(!(Binomial %in% absent_spp)) %>% select(-c(Binomial,polygon)) %>% as.data.frame()
rownames(traits) <- af_data$Binomial
traits <- af_data %>% filter(!(Binomial %in% absent_spp)) %>% select(-polygon) %>% as.data.frame()
rownames(traits) <- traits$Binomial
traits <- traits %>% select(-Binomial)
comm <- spp_mat %>% select(-c(x,y,richness))
a <- hill_func(comm,traits)
a
View(a)
nrow(a)
ncol(a)
a[,1:10]
?hill_func
func_q0 <- hill_func(comm,traits, q = 0)
func_q1 <- hill_func(comm,traits, q = 1)
func_q2 <- hill_func(comm,traits, q = 2)
save.image('AF_macro.RData')
func_q0[,3]
nrow(func_q0)
func_q0[,1:10]
func_q1[,1:10]
func_q2[,1:10]
glimpse(spp_mat)
func_q1[,1:10]
nrow(spp_mat)
ncol(funct_q1)
ncol(func_q1)
spp_mat <- spp_mat %>% mutate(func_q0 = func_q0[3,])
ggplot()+
geom_tile(data = spp_mat, aes(x=x,y=y,fill=func_q0))+
scale_fill_gradient2(low = '#2b83ba', mid = '#fffebd', high = '#d7191c',
midpoint = max(spp_mat$func_q0)/2)+
coord_sf(xlim = c(ext[1],ext[2]), ylim = c(ext[3],ext[4]),
expand = FALSE)
hist(spp_mat$func_q0)
ggplot()+
geom_tile(data = spp_mat, aes(x=x,y=y,fill=func_q0))+
scale_fill_gradient2(low = '#2b83ba', mid = '#fffebd', high = '#d7191c',
midpoint = 180)+
coord_sf(xlim = c(ext[1],ext[2]), ylim = c(ext[3],ext[4]),
expand = FALSE)
ggplot()+
geom_tile(data = spp_mat, aes(x=x,y=y,fill=func_q0))+
scale_fill_gradient2(low = '#2b83ba', mid = '#fffebd', high = '#d7191c',
midpoint = 180)+
coord_sf(xlim = c(ext[1],ext[2]), ylim = c(ext[3],ext[4]),
expand = FALSE)
ggplot()+
geom_tile(data = spp_mat, aes(x=x,y=y,fill=func_q0))+
scale_fill_gradient2(low = '#2b83ba', mid = '#fffebd', high = '#d7191c',
midpoint = 170)+
coord_sf(xlim = c(ext[1],ext[2]), ylim = c(ext[3],ext[4]),
expand = FALSE)
ggplot()+
geom_tile(data = spp_mat, aes(x=x,y=y,fill=func_q0))+
scale_fill_gradient2(low = '#2b83ba', mid = '#fffebd', high = '#d7191c',
midpoint = 160)+
coord_sf(xlim = c(ext[1],ext[2]), ylim = c(ext[3],ext[4]),
expand = FALSE)
spp_mat$richness[1:10]
spp_mat$func_q0[1:10]
func_q0
func_q0[,1:10]
func_q1[,1:10]
spp_mat <- spp_mat %>% mutate(D_func = func_q0[3,],
FD = func_q0[5,])
ncol(func_q0)
nrow(func_q0)
func_q0[3,]
func_q0[5,]
spp_mat <- spp_mat %>% mutate(D_func = func_q0[3,],
FD = func_q0[5,])
nrow(spp_mat)
ncol(func_q0)
length(func_q0[,3])
length(func_q0[3,])
length(func_q0[5,])
glimpse(spp_mat)
spp_mat <- spp_mat %>% select(-func_q0)
spp_mat <- spp_mat %>% dplyr::select(-func_q0)
spp_mat <- spp_mat %>% mutate(D_func = func_q0[3,],
FD = func_q0[5,])
ggplot()+
geom_tile(data = spp_mat, aes(x=x,y=y,fill=D_func))+
scale_fill_gradient2(low = '#2b83ba', mid = '#fffebd', high = '#d7191c',
midpoint = 160)+
coord_sf(xlim = c(ext[1],ext[2]), ylim = c(ext[3],ext[4]),
expand = FALSE)
ggplot()+
geom_tile(data = spp_mat, aes(x=x,y=y,fill=FD))+
scale_fill_gradient2(low = '#2b83ba', mid = '#fffebd', high = '#d7191c',
midpoint = max(spp_mat$FD)/2)+
coord_sf(xlim = c(ext[1],ext[2]), ylim = c(ext[3],ext[4]),
expand = FALSE)
traits
climdata <- stack(list.files('data/spatial/raster/climdata/01_cur_chelsa_V1_2B_r2_5m/',
pattern = '.tif$',full.names = T))
climdata <- stack(list.files('data/spatial/raster/climdata/01_cur_chelsa_V1_2B_r2_5m/',
pattern = '.tif$',full.names = T)) %>%
raster::mask(as_Spatial(af_shapefile)) %>% rasterToPoints()
head(climdata)
nrow(climdata)
spp_mat[,1:2]
climstack <- stack(list.files('data/spatial/raster/climdata/01_cur_chelsa_V1_2B_r2_5m/',
pattern = '.tif$',full.names = T))
climdata <- extract(spp_mat[,1:2],climstack) %>% bind_cols(spp_mat)
climdata <- raster::extract(spp_mat[,1:2],climstack) %>% bind_cols(spp_mat)
climdata <- extract(climstack,spp_mat[,1:2]) %>% bind_cols(spp_mat)
climdata
climdata <- extract(climstack,spp_mat[,1:2]) %>%
mutate(richness = spp_mat$richness,
D_func = spp_mat$D_func,
FD = spp_mat$FD)
climdata <- extract(climstack,spp_mat[,1:2]) %>% as_tibble() %>%
mutate(richness = spp_mat$richness,
D_func = spp_mat$D_func,
FD = spp_mat$FD)
climdata
glimpse(climdata)
ggplot(climdata,aes(x = bio1,y=richness))+geom_point()
ggplot(climdata,aes(x = bio_1,y=richness))+geom_point()
cor_mat <- corrr::correlate(climdata)
cor_mat <- corrr::correlate(climdata, method = 'Spearman')
cor_mat <- corrr::correlate(climdata, method = 'spearman')
View(cor_mat)
?corrr
?pivot_longer
cor_mat <- corrr::correlate(climdata, method = 'spearman') %>%
filter(term %in% c('richness','D_func','FD'))
a <- pivot_longer(cor_mat,
cols = starts_with('bio'),
names_to = 'climate')
View(a)
cor_mat <- corrr::correlate(climdata, method = 'spearman') %>%
filter(term %in% c('richness','D_func','FD')) %>%
select(-c('richness','D_func','FD')) %>%
pivot_longer(cols = any(),
names_to = 'climate')
cor_mat <- corrr::correlate(climdata, method = 'spearman') %>%
filter(term %in% c('richness','D_func','FD')) %>%
dplyr::select(-c('richness','D_func','FD')) %>%
pivot_longer(cols = any(),
names_to = 'climate')
cor_mat <- corrr::correlate(climdata, method = 'spearman') %>%
filter(term %in% c('richness','D_func','FD')) %>%
dplyr::select(-c('richness','D_func','FD')) %>%
pivot_longer(cols = everything(),
names_to = 'climate')
cor_mat <- corrr::correlate(climdata, method = 'spearman') %>%
filter(term %in% c('richness','D_func','FD')) %>%
dplyr::select(-c('richness','D_func','FD')) %>%
pivot_longer(cols = starts_with('bio'),
names_to = 'climate')
View(cor_mat)
sig_cor <- cor_mat %>% filter((value < -0.5) | (value > 0.5))
sig_cor
save.image('AF_macro.RData')
